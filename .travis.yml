matrix:
  include:
  - os: osx
    language: generic
    osx_image: xcode11.1

before_install:
- pip3 install --upgrade pip setuptools wheel

install:
- pip3 install -r requirements.txt
- pip3 install certifi https://github.com/pyinstaller/pyinstaller/archive/develop.zip
- npm install -g appdmg

script: python3 setup.py build_binary

before_deploy:
- shopt -s extglob
- rm -r dist/!(*.deb|*.dmg)

deploy:
  provider: gcs
  access_key_id: GOOG1EC62457RKUYFR2TIZUWV4EFSV2EP5LVLPPFXUAKADWJFDYPFW63BQSLA
  secret_access_key:
    secure: [REDACTED]
  bucket: kcc-deploy
  local-dir: dist
  skip_cleanup: true
  on:
    repo: AcidWeb/KCC
